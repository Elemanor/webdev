<!-- Product Growth Engine - Ethan Chen-Williams Implementation -->
<!-- 
Persona: Ethan Chen-Williams
Title: VP of Product Growth at HyperScale
Background: Former ProductLed advisor, Reforge alumni, scaled 3 SaaS products to $100M ARR
Expertise: Product-led growth, viral loops, conversion optimization, user activation
Philosophy: "Every pixel should drive growth. Build products that sell themselves."
-->

<section class="growth-engine-section" id="growth-accelerator">
    <!-- Growth Metrics Dashboard -->
    <div class="metrics-banner bg-dark text-white py-2">
        <div class="container">
            <div class="metrics-ticker">
                <span class="metric-item">
                    <i class="fas fa-chart-line text-success"></i>
                    <span class="metric-value" data-metric="active-users">2,847</span>
                    <span class="metric-label">Happy Basements</span>
                </span>
                <span class="metric-divider">‚Ä¢</span>
                <span class="metric-item">
                    <i class="fas fa-clock text-warning"></i>
                    <span class="metric-value" data-metric="ttv">15min</span>
                    <span class="metric-label">Time to Quote</span>
                </span>
                <span class="metric-divider">‚Ä¢</span>
                <span class="metric-item">
                    <i class="fas fa-percentage text-info"></i>
                    <span class="metric-value" data-metric="conversion">47%</span>
                    <span class="metric-label">Close Rate</span>
                </span>
                <span class="metric-divider">‚Ä¢</span>
                <span class="metric-item">
                    <i class="fas fa-star text-warning"></i>
                    <span class="metric-value" data-metric="nps">72</span>
                    <span class="metric-label">NPS Score</span>
                </span>
            </div>
        </div>
    </div>

    <!-- Product-Led Hero with Activation Focus -->
    <div class="plg-hero py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <!-- Value Proposition with Aha Moment -->
                    <div class="value-prop-engine">
                        <div class="social-proof-badge mb-3">
                            <img src="/images/homeowner-avatar-1.jpg" alt="Customer" class="avatar">
                            <img src="/images/homeowner-avatar-2.jpg" alt="Customer" class="avatar overlap">
                            <img src="/images/homeowner-avatar-3.jpg" alt="Customer" class="avatar overlap">
                            <span class="proof-text">Join 2,847 dry basements in Toronto</span>
                        </div>
                        
                        <h1 class="growth-headline">
                            Your Basement Dry in <span class="highlight-metric">24 Hours</span>
                            <span class="sub-headline d-block mt-2">See exactly how much it costs in 60 seconds</span>
                        </h1>
                        
                        <!-- Activation Journey -->
                        <div class="activation-steps mt-4">
                            <div class="step-progress">
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <div class="steps-list">
                                    <span class="step active">1. Problem Type</span>
                                    <span class="step">2. Severity Level</span>
                                    <span class="step">3. Instant Quote</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Primary CTA with Urgency -->
                        <div class="activation-cta mt-4">
                            <button class="btn btn-primary btn-lg growth-cta" onclick="startActivationFlow()">
                                Get My Free Quote
                                <span class="cta-timer">in 60 seconds</span>
                            </button>
                            <p class="micro-commitment mt-2">
                                <i class="fas fa-shield-alt text-success"></i>
                                No credit card ‚Ä¢ No obligation ‚Ä¢ 100% free
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <!-- Interactive Product Demo -->
                    <div class="product-demo-widget">
                        <div class="demo-header">
                            <span class="live-indicator"></span>
                            <span>Live Waterproofing Calculator</span>
                        </div>
                        <div class="demo-screen">
                            <div class="calculator-preview">
                                <div class="calc-display">
                                    <span class="calc-label">Your Estimated Cost:</span>
                                    <span class="calc-value">$0</span>
                                </div>
                                <div class="problem-selector">
                                    <button class="problem-option" data-problem="leak" data-cost="2500">
                                        <i class="fas fa-tint"></i>
                                        <span>Water Leak</span>
                                    </button>
                                    <button class="problem-option" data-problem="crack" data-cost="1800">
                                        <i class="fas fa-bolt"></i>
                                        <span>Wall Crack</span>
                                    </button>
                                    <button class="problem-option" data-problem="flood" data-cost="3500">
                                        <i class="fas fa-water"></i>
                                        <span>Flooding</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="demo-footer">
                            <span class="update-text">Updates in real-time</span>
                            <button class="btn btn-sm btn-outline-primary">Try It</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Viral Loop Component -->
    <div class="viral-loop-section py-4 bg-light">
        <div class="container">
            <div class="referral-widget">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h3 class="h5 mb-2">
                            <i class="fas fa-gift text-primary me-2"></i>
                            Get $250 Off + Give $250 to a Neighbor
                        </h3>
                        <p class="mb-0">Share your unique code after booking. Both save when they book!</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <button class="btn btn-primary" onclick="activateReferralProgram()">
                            Activate Rewards
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
                <div class="social-sharing-strip mt-3">
                    <span class="share-label">Quick share:</span>
                    <button class="share-btn whatsapp"><i class="fab fa-whatsapp"></i></button>
                    <button class="share-btn facebook"><i class="fab fa-facebook"></i></button>
                    <button class="share-btn email"><i class="fas fa-envelope"></i></button>
                    <button class="share-btn sms"><i class="fas fa-sms"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Growth Loops Implementation -->
    <div class="growth-loops py-5">
        <div class="container">
            <!-- User-Generated Content Loop -->
            <div class="ugc-loop mb-5">
                <h3 class="h4 mb-4">Real Results from Your Neighbors</h3>
                <div class="results-carousel">
                    <div class="result-card">
                        <div class="before-after">
                            <img src="/images/before-basement-1.jpg" alt="Before" class="before">
                            <img src="/images/after-basement-1.jpg" alt="After" class="after">
                            <span class="transformation-badge">24hr Transform</span>
                        </div>
                        <div class="result-details">
                            <div class="customer-info">
                                <strong>Sarah M.</strong> ‚Ä¢ Bloor West
                                <div class="rating">
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                </div>
                            </div>
                            <p class="result-quote">"Can't believe how fast they fixed our flooding issue!"</p>
                            <button class="btn btn-sm btn-outline-primary share-result">
                                <i class="fas fa-share"></i> Share
                            </button>
                        </div>
                    </div>
                </div>
                <div class="ugc-cta text-center mt-3">
                    <button class="btn btn-link" onclick="uploadYourResult()">
                        <i class="fas fa-camera me-2"></i>
                        Share Your Transformation
                    </button>
                </div>
            </div>

            <!-- Product Qualified Lead (PQL) Scoring -->
            <div class="pql-engine">
                <div class="lead-scoring-widget">
                    <h4 class="h5 mb-3">Your Waterproofing Readiness Score</h4>
                    <div class="score-factors">
                        <div class="factor-item completed">
                            <i class="fas fa-check-circle text-success"></i>
                            <span>Identified problem area</span>
                            <span class="points">+25</span>
                        </div>
                        <div class="factor-item" id="photo-factor">
                            <i class="fas fa-camera text-muted"></i>
                            <span>Upload problem photo</span>
                            <span class="points">+25</span>
                        </div>
                        <div class="factor-item" id="urgency-factor">
                            <i class="fas fa-exclamation-triangle text-muted"></i>
                            <span>Set urgency level</span>
                            <span class="points">+25</span>
                        </div>
                        <div class="factor-item" id="calendar-factor">
                            <i class="fas fa-calendar text-muted"></i>
                            <span>Pick preferred date</span>
                            <span class="points">+25</span>
                        </div>
                    </div>
                    <div class="readiness-score">
                        <div class="score-meter">
                            <div class="score-fill" style="width: 25%"></div>
                        </div>
                        <p class="score-text">25% Ready - Complete more steps to unlock priority service</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conversion Rate Optimization Features -->
    <div class="cro-features py-4 bg-white">
        <div class="container">
            <!-- Multi-Variant Testing Widget -->
            <div class="mvt-widget" data-experiment="hero-messaging">
                <div class="variant-a" style="display: none;">
                    <h2>Stop Water Damage Before It Starts</h2>
                </div>
                <div class="variant-b" style="display: none;">
                    <h2>Toronto's Most Trusted Waterproofing</h2>
                </div>
                <div class="variant-c" style="display: none;">
                    <h2>Dry Basement Guaranteed or Your Money Back</h2>
                </div>
            </div>

            <!-- Behavioral Triggers -->
            <div class="behavior-triggers">
                <!-- Exit Intent Popup -->
                <div class="exit-intent-modal" id="exit-capture" style="display: none;">
                    <div class="modal-content">
                        <h3>Wait! Don't Let Your Basement Flood</h3>
                        <p>Get 15% off if you book in the next 24 hours</p>
                        <div class="countdown-timer" data-hours="24">
                            <span class="hours">24</span>:
                            <span class="minutes">00</span>:
                            <span class="seconds">00</span>
                        </div>
                        <input type="email" placeholder="Enter email for discount code" class="form-control mb-3">
                        <button class="btn btn-primary w-100">Claim My 15% Discount</button>
                    </div>
                </div>

                <!-- Scroll Depth Trigger -->
                <div class="scroll-cta" id="scroll-trigger" style="display: none;">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        You've reviewed 50% of our solutions. Ready to protect your basement?
                        <button class="btn btn-sm btn-primary ms-3">Get Started</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Analytics & Insights -->
    <div class="analytics-dashboard py-4">
        <div class="container">
            <div class="insights-widget">
                <h4 class="h6 text-muted mb-3">Live Toronto Waterproofing Insights</h4>
                <div class="insight-cards">
                    <div class="insight-card">
                        <div class="insight-icon">üåßÔ∏è</div>
                        <div class="insight-data">
                            <span class="insight-value">73%</span>
                            <span class="insight-label">More calls during rain</span>
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon">üìç</div>
                        <div class="insight-data">
                            <span class="insight-value">High Park</span>
                            <span class="insight-label">Most active area today</span>
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon">‚ö°</div>
                        <div class="insight-data">
                            <span class="insight-value">2.3hrs</span>
                            <span class="insight-label">Avg response time</span>
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon">üí∞</div>
                        <div class="insight-data">
                            <span class="insight-value">$2,847</span>
                            <span class="insight-label">Avg project cost</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Retention & Engagement Features -->
    <div class="retention-engine py-5 bg-light">
        <div class="container">
            <!-- Customer Success Milestones -->
            <div class="milestone-tracker mb-4">
                <h3 class="h4 mb-3">Your Dry Basement Journey</h3>
                <div class="milestone-timeline">
                    <div class="milestone completed">
                        <i class="fas fa-check-circle"></i>
                        <span>Quote Received</span>
                        <small>Just now</small>
                    </div>
                    <div class="milestone active">
                        <i class="fas fa-circle"></i>
                        <span>Schedule Inspection</span>
                        <small>Next step</small>
                    </div>
                    <div class="milestone">
                        <i class="far fa-circle"></i>
                        <span>Work Begins</span>
                        <small>2-3 days</small>
                    </div>
                    <div class="milestone">
                        <i class="far fa-circle"></i>
                        <span>Basement Protected</span>
                        <small>24 hours</small>
                    </div>
                    <div class="milestone">
                        <i class="far fa-circle"></i>
                        <span>Lifetime Warranty</span>
                        <small>Forever dry</small>
                    </div>
                </div>
            </div>

            <!-- Engagement Loops -->
            <div class="engagement-features">
                <div class="row">
                    <div class="col-md-4">
                        <div class="engagement-card">
                            <i class="fas fa-bell fa-2x text-primary mb-3"></i>
                            <h5>Smart Reminders</h5>
                            <p>Get alerts before heavy rain to check your basement</p>
                            <button class="btn btn-sm btn-outline-primary">Enable Alerts</button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="engagement-card">
                            <i class="fas fa-book fa-2x text-success mb-3"></i>
                            <h5>Maintenance Guide</h5>
                            <p>Monthly tips to keep your basement dry forever</p>
                            <button class="btn btn-sm btn-outline-success">Get Guide</button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="engagement-card">
                            <i class="fas fa-users fa-2x text-info mb-3"></i>
                            <h5>Homeowner Community</h5>
                            <p>Join 2,847 Toronto homeowners protecting their basements</p>
                            <button class="btn btn-sm btn-outline-info">Join Community</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- North Star Metric Display -->
    <div class="north-star-metric py-3 bg-primary text-white">
        <div class="container text-center">
            <div class="metric-display">
                <span class="metric-label">Basements Protected This Month:</span>
                <span class="metric-number" data-count="127">127</span>
                <span class="metric-growth">
                    <i class="fas fa-arrow-up"></i> 23% vs last month
                </span>
            </div>
        </div>
    </div>
</section>

<!-- Growth Engine Styles -->
<style>
/* Growth Metrics Banner */
.metrics-banner {
    font-size: 0.875rem;
    overflow: hidden;
}

.metrics-ticker {
    display: flex;
    align-items: center;
    gap: 2rem;
    animation: scroll-metrics 30s linear infinite;
}

@keyframes scroll-metrics {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

.metric-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
}

.metric-value {
    font-weight: 700;
    font-size: 1.125rem;
}

.metric-label {
    opacity: 0.9;
}

.metric-divider {
    opacity: 0.5;
}

/* PLG Hero */
.social-proof-badge {
    display: inline-flex;
    align-items: center;
    background: #f8f9fa;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    gap: 0.5rem;
}

.avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid white;
    background: #e9ecef;
}

.avatar.overlap {
    margin-left: -12px;
}

.proof-text {
    font-size: 0.875rem;
    color: #495057;
}

.growth-headline {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
}

.highlight-metric {
    color: #0d6efd;
    background: linear-gradient(120deg, #e7f3ff 0%, #cce5ff 100%);
    padding: 0 0.5rem;
    border-radius: 8px;
}

.sub-headline {
    font-size: 1.25rem;
    font-weight: 400;
    color: #6c757d;
}

/* Activation Steps */
.activation-steps {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 12px;
}

.progress-bar-container {
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 1rem;
}

.progress-bar-fill {
    height: 100%;
    background: #0d6efd;
    transition: width 0.3s ease;
}

.steps-list {
    display: flex;
    justify-content: space-between;
    font-size: 0.875rem;
}

.step {
    color: #adb5bd;
    position: relative;
}

.step.active {
    color: #0d6efd;
    font-weight: 600;
}

/* Growth CTA */
.growth-cta {
    position: relative;
    padding: 1rem 2rem;
    font-size: 1.125rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.cta-timer {
    display: block;
    font-size: 0.875rem;
    font-weight: 400;
    opacity: 0.9;
}

.growth-cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(13,110,253,0.3);
}

.micro-commitment {
    font-size: 0.875rem;
    color: #6c757d;
}

/* Product Demo Widget */
.product-demo-widget {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    overflow: hidden;
}

.demo-header {
    padding: 1rem;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #495057;
}

.live-indicator {
    width: 8px;
    height: 8px;
    background: #28a745;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(40,167,69,0.7); }
    70% { box-shadow: 0 0 0 10px rgba(40,167,69,0); }
    100% { box-shadow: 0 0 0 0 rgba(40,167,69,0); }
}

.demo-screen {
    padding: 2rem;
}

.calc-display {
    text-align: center;
    margin-bottom: 2rem;
}

.calc-label {
    display: block;
    font-size: 0.875rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
}

.calc-value {
    font-size: 3rem;
    font-weight: 700;
    color: #0d6efd;
}

.problem-selector {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.problem-option {
    padding: 1.5rem 1rem;
    background: #f8f9fa;
    border: 2px solid transparent;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.problem-option:hover {
    border-color: #0d6efd;
    background: #e7f3ff;
}

.problem-option.active {
    border-color: #0d6efd;
    background: #0d6efd;
    color: white;
}

.problem-option i {
    font-size: 2rem;
    display: block;
    margin-bottom: 0.5rem;
}

.demo-footer {
    padding: 1rem;
    background: #f8f9fa;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.875rem;
}

/* Viral Loop */
.referral-widget {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.social-sharing-strip {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-top: 1rem;
    border-top: 1px solid #e9ecef;
}

.share-label {
    font-size: 0.875rem;
    color: #6c757d;
}

.share-btn {
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.share-btn.whatsapp { background: #25D366; color: white; }
.share-btn.facebook { background: #1877F2; color: white; }
.share-btn.email { background: #EA4335; color: white; }
.share-btn.sms { background: #0d6efd; color: white; }

.share-btn:hover {
    transform: scale(1.1);
}

/* Growth Loops */
.result-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.before-after {
    position: relative;
    display: grid;
    grid-template-columns: 1fr 1fr;
    height: 200px;
}

.before, .after {
    object-fit: cover;
    width: 100%;
    height: 100%;
    background: #e9ecef;
}

.transformation-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: #28a745;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
}

.result-details {
    padding: 1.5rem;
}

.customer-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.rating {
    display: flex;
    gap: 0.125rem;
}

.result-quote {
    font-style: italic;
    color: #495057;
    margin: 0.5rem 0;
}

/* PQL Scoring */
.lead-scoring-widget {
    background: #f8f9fa;
    padding: 2rem;
    border-radius: 12px;
}

.score-factors {
    display: grid;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.factor-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem;
    background: white;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.factor-item.completed {
    background: #d1f2eb;
}

.factor-item i {
    font-size: 1.25rem;
}

.factor-item span:last-child {
    margin-left: auto;
    font-weight: 600;
    color: #28a745;
}

.score-meter {
    height: 20px;
    background: #e9ecef;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 0.5rem;
}

.score-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffc107 0%, #28a745 100%);
    transition: width 0.5s ease;
}

/* Analytics Dashboard */
.insights-widget {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 12px;
}

.insight-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.insight-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: white;
    padding: 1rem;
    border-radius: 8px;
}

.insight-icon {
    font-size: 2rem;
}

.insight-data {
    display: flex;
    flex-direction: column;
}

.insight-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: #212529;
}

.insight-label {
    font-size: 0.75rem;
    color: #6c757d;
}

/* Milestone Timeline */
.milestone-timeline {
    display: flex;
    position: relative;
    padding: 2rem 0;
}

.milestone-timeline::before {
    content: '';
    position: absolute;
    top: 3rem;
    left: 0;
    right: 0;
    height: 2px;
    background: #e9ecef;
}

.milestone {
    flex: 1;
    text-align: center;
    position: relative;
}

.milestone i {
    font-size: 1.5rem;
    display: block;
    margin-bottom: 0.5rem;
    position: relative;
    z-index: 1;
    background: white;
    width: 40px;
    height: 40px;
    margin: 0 auto 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.milestone.completed i {
    color: #28a745;
}

.milestone.active i {
    color: #0d6efd;
}

.milestone span {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
}

.milestone small {
    display: block;
    font-size: 0.75rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

/* Engagement Cards */
.engagement-card {
    text-align: center;
    padding: 2rem;
    background: white;
    border-radius: 12px;
    height: 100%;
    transition: all 0.3s ease;
}

.engagement-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

/* North Star Metric */
.north-star-metric {
    position: sticky;
    bottom: 0;
    z-index: 100;
}

.metric-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.metric-number {
    font-size: 2rem;
    font-weight: 700;
}

.metric-growth {
    font-size: 0.875rem;
    opacity: 0.9;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    .growth-headline {
        font-size: 2rem;
    }
    
    .problem-selector {
        grid-template-columns: 1fr;
    }
    
    .insight-cards {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .milestone-timeline {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .milestone span {
        font-size: 0.75rem;
    }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
    .growth-engine-section {
        background: #1a1a1a;
        color: white;
    }
    
    .product-demo-widget,
    .referral-widget,
    .result-card,
    .engagement-card {
        background: #2d2d2d;
        color: white;
    }
    
    .demo-header,
    .demo-footer,
    .insights-widget {
        background: #343a40;
    }
}
</style>

<!-- Growth Engine JavaScript -->
<script>
// Product Growth Engine Controller - Ethan Chen-Williams
class GrowthEngine {
    constructor() {
        this.metrics = {
            activeUsers: 2847,
            timeToValue: 15,
            conversionRate: 47,
            npsScore: 72,
            monthlyGrowth: 23
        };
        
        this.userJourney = {
            stage: 'awareness',
            score: 25,
            factors: {
                problemIdentified: true,
                photoUploaded: false,
                urgencySet: false,
                dateSelected: false
            }
        };
        
        this.experiments = {
            heroMessaging: 'variant-a',
            ctaColor: 'blue',
            socialProof: 'avatars'
        };
        
        this.init();
    }

    init() {
        this.startMetricAnimations();
        this.initializeActivationFlow();
        this.setupBehaviorTracking();
        this.initializeViralLoops();
        this.runExperiments();
        this.trackProductAnalytics();
    }

    startMetricAnimations() {
        // Animate metric counters
        document.querySelectorAll('[data-metric]').forEach(element => {
            const metric = element.dataset.metric;
            const endValue = this.metrics[this.toCamelCase(metric)];
            this.animateCounter(element, endValue);
        });

        // Update live metrics every 30 seconds
        setInterval(() => {
            this.updateLiveMetrics();
        }, 30000);
    }

    animateCounter(element, endValue) {
        const duration = 2000;
        const startTime = Date.now();
        const startValue = 0;

        const update = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            if (typeof endValue === 'number') {
                const current = Math.floor(startValue + (endValue - startValue) * progress);
                element.textContent = current.toLocaleString();
            }
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        };

        requestAnimationFrame(update);
    }

    initializeActivationFlow() {
        // Track activation progress
        const progressBar = document.querySelector('.progress-bar-fill');
        const steps = document.querySelectorAll('.activation-steps .step');
        
        // Problem selector interaction
        document.querySelectorAll('.problem-option').forEach(option => {
            option.addEventListener('click', (e) => {
                // Update selection
                document.querySelectorAll('.problem-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                e.currentTarget.classList.add('active');
                
                // Update calculator
                const cost = e.currentTarget.dataset.cost;
                const display = document.querySelector('.calc-value');
                this.animatePrice(display, cost);
                
                // Track activation
                this.trackActivation('problem_selected', {
                    problem: e.currentTarget.dataset.problem,
                    estimated_cost: cost
                });
                
                // Update progress
                this.updateActivationProgress(33);
            });
        });
    }

    animatePrice(element, targetPrice) {
        const duration = 1000;
        const startPrice = parseInt(element.textContent.replace(/[^0-9]/g, '')) || 0;
        const endPrice = parseInt(targetPrice);
        const startTime = Date.now();

        const update = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const current = Math.floor(startPrice + (endPrice - startPrice) * progress);
            
            element.textContent = `$${current.toLocaleString()}`;
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        };

        requestAnimationFrame(update);
    }

    setupBehaviorTracking() {
        // Exit intent detection
        let exitIntentShown = false;
        document.addEventListener('mouseleave', (e) => {
            if (e.clientY <= 0 && !exitIntentShown) {
                this.showExitIntent();
                exitIntentShown = true;
            }
        });

        // Scroll depth tracking
        let maxScroll = 0;
        window.addEventListener('scroll', () => {
            const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
            
            if (scrollPercent > maxScroll) {
                maxScroll = scrollPercent;
                
                // Show scroll CTA at 50%
                if (scrollPercent > 50 && !document.querySelector('#scroll-trigger').dataset.shown) {
                    this.showScrollCTA();
                }
                
                // Track milestones
                if (scrollPercent > 25) this.trackEvent('scroll_25');
                if (scrollPercent > 50) this.trackEvent('scroll_50');
                if (scrollPercent > 75) this.trackEvent('scroll_75');
            }
        });

        // Time on page tracking
        let timeOnPage = 0;
        setInterval(() => {
            timeOnPage += 1;
            
            // Show engagement prompts based on time
            if (timeOnPage === 30) this.showEngagementPrompt('quick_quote');
            if (timeOnPage === 60) this.showEngagementPrompt('chat_available');
            if (timeOnPage === 120) this.showEngagementPrompt('callback_offer');
        }, 1000);
    }

    showExitIntent() {
        const modal = document.getElementById('exit-capture');
        if (modal) {
            modal.style.display = 'block';
            this.startCountdown();
            this.trackEvent('exit_intent_shown');
        }
    }

    showScrollCTA() {
        const cta = document.getElementById('scroll-trigger');
        if (cta) {
            cta.style.display = 'block';
            cta.dataset.shown = 'true';
            this.trackEvent('scroll_cta_shown');
        }
    }

    startCountdown() {
        const timer = document.querySelector('.countdown-timer');
        if (!timer) return;

        let hours = parseInt(timer.dataset.hours) || 24;
        let totalSeconds = hours * 3600;

        const updateTimer = () => {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            timer.querySelector('.hours').textContent = String(hours).padStart(2, '0');
            timer.querySelector('.minutes').textContent = String(minutes).padStart(2, '0');
            timer.querySelector('.seconds').textContent = String(seconds).padStart(2, '0');

            if (totalSeconds > 0) {
                totalSeconds--;
                setTimeout(updateTimer, 1000);
            }
        };

        updateTimer();
    }

    initializeViralLoops() {
        // Referral program
        window.activateReferralProgram = () => {
            const code = this.generateReferralCode();
            this.trackEvent('referral_activated', { code });
            
            // Show share options
            alert(`Your referral code: ${code}\nShare to get $250 off!`);
        };

        // Social sharing
        document.querySelectorAll('.share-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const platform = e.currentTarget.className.split(' ')[1];
                this.shareOnPlatform(platform);
            });
        });

        // UGC uploads
        window.uploadYourResult = () => {
            this.trackEvent('ugc_upload_initiated');
            alert('Upload feature would open here');
        };
    }

    generateReferralCode() {
        return 'DRY' + Math.random().toString(36).substr(2, 6).toUpperCase();
    }

    shareOnPlatform(platform) {
        const url = window.location.href;
        const text = 'Just saved $250 on basement waterproofing with Dryspace!';
        
        const shareUrls = {
            whatsapp: `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`,
            facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`,
            email: `mailto:?subject=Save on Waterproofing&body=${encodeURIComponent(text + ' ' + url)}`,
            sms: `sms:?body=${encodeURIComponent(text + ' ' + url)}`
        };

        if (shareUrls[platform]) {
            window.open(shareUrls[platform], '_blank');
            this.trackEvent('social_share', { platform });
        }
    }

    runExperiments() {
        // A/B test hero messaging
        const variants = document.querySelectorAll('.mvt-widget > div');
        const selectedVariant = Math.floor(Math.random() * variants.length);
        
        variants.forEach((variant, index) => {
            variant.style.display = index === selectedVariant ? 'block' : 'none';
        });

        this.trackEvent('experiment_viewed', {
            experiment: 'hero_messaging',
            variant: `variant_${String.fromCharCode(97 + selectedVariant)}`
        });
    }

    updateActivationProgress(percent) {
        const progressBar = document.querySelector('.progress-bar-fill');
        if (progressBar) {
            progressBar.style.width = `${percent}%`;
        }

        // Update PQL score
        this.updatePQLScore();
    }

    updatePQLScore() {
        const factors = document.querySelectorAll('.factor-item');
        let score = 0;
        let completed = 0;

        factors.forEach(factor => {
            if (factor.classList.contains('completed')) {
                score += 25;
                completed++;
            }
        });

        // Update display
        const scoreFill = document.querySelector('.score-fill');
        const scoreText = document.querySelector('.score-text');
        
        if (scoreFill) scoreFill.style.width = `${score}%`;
        if (scoreText) {
            const status = score === 100 ? 'Fully Ready' : `${score}% Ready`;
            scoreText.textContent = `${status} - ${score === 100 ? 'Priority service unlocked!' : 'Complete more steps to unlock priority service'}`;
        }

        // Track PQL progression
        this.trackEvent('pql_score_updated', { score, factors_completed: completed });
    }

    updateLiveMetrics() {
        // Simulate live metric updates
        this.metrics.activeUsers += Math.floor(Math.random() * 5);
        
        // Update display
        const activeUsersEl = document.querySelector('[data-metric="active-users"]');
        if (activeUsersEl) {
            this.animateCounter(activeUsersEl, this.metrics.activeUsers);
        }

        // Update insights
        this.updateInsights();
    }

    updateInsights() {
        const insights = {
            rain_impact: Math.floor(70 + Math.random() * 10),
            active_area: ['High Park', 'Beaches', 'Etobicoke', 'North York'][Math.floor(Math.random() * 4)],
            response_time: (2 + Math.random()).toFixed(1),
            avg_cost: Math.floor(2500 + Math.random() * 1000)
        };

        // Update insight cards
        document.querySelectorAll('.insight-card').forEach((card, index) => {
            const valueEl = card.querySelector('.insight-value');
            if (valueEl) {
                switch(index) {
                    case 0: valueEl.textContent = `${insights.rain_impact}%`; break;
                    case 1: valueEl.textContent = insights.active_area; break;
                    case 2: valueEl.textContent = `${insights.response_time}hrs`; break;
                    case 3: valueEl.textContent = `$${insights.avg_cost.toLocaleString()}`; break;
                }
            }
        });
    }

    trackProductAnalytics() {
        // Initialize product analytics
        this.analytics = {
            session_id: this.generateSessionId(),
            user_id: this.getUserId(),
            events: []
        };

        // Track page view
        this.trackEvent('page_view', {
            page: 'homepage',
            referrer: document.referrer,
            utm_source: this.getUTMParam('utm_source'),
            utm_medium: this.getUTMParam('utm_medium'),
            utm_campaign: this.getUTMParam('utm_campaign')
        });

        // Track engagement events
        this.trackEngagementMetrics();
    }

    trackEngagementMetrics() {
        // Track time to first interaction
        let firstInteraction = false;
        document.addEventListener('click', () => {
            if (!firstInteraction) {
                const timeToInteract = Date.now() - window.performance.timing.navigationStart;
                this.trackEvent('first_interaction', { time_ms: timeToInteract });
                firstInteraction = true;
            }
        });

        // Track rage clicks
        let clickCount = 0;
        let clickTimer = null;
        document.addEventListener('click', (e) => {
            clickCount++;
            
            if (clickCount >= 3) {
                this.trackEvent('rage_click', {
                    element: e.target.tagName,
                    click_count: clickCount
                });
            }

            clearTimeout(clickTimer);
            clickTimer = setTimeout(() => {
                clickCount = 0;
            }, 1000);
        });
    }

    trackActivation(action, data = {}) {
        this.trackEvent(`activation_${action}`, {
            ...data,
            journey_stage: this.userJourney.stage,
            journey_score: this.userJourney.score
        });

        // Update journey stage
        if (this.userJourney.score >= 75) {
            this.userJourney.stage = 'decision';
        } else if (this.userJourney.score >= 50) {
            this.userJourney.stage = 'consideration';
        }
    }

    trackEvent(eventName, properties = {}) {
        const event = {
            name: eventName,
            timestamp: Date.now(),
            properties: {
                ...properties,
                session_id: this.analytics?.session_id,
                user_id: this.analytics?.user_id
            }
        };

        // Send to analytics
        if (typeof gtag !== 'undefined') {
            gtag('event', eventName, {
                event_category: 'Growth',
                ...properties
            });
        }

        // Store locally
        if (this.analytics) {
            this.analytics.events.push(event);
        }

        console.log('Growth Event:', event);
    }

    showEngagementPrompt(type) {
        // Show contextual prompts based on user behavior
        console.log(`Engagement prompt: ${type}`);
    }

    generateSessionId() {
        return 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    getUserId() {
        let userId = localStorage.getItem('growth_user_id');
        if (!userId) {
            userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('growth_user_id', userId);
        }
        return userId;
    }

    getUTMParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param) || null;
    }

    toCamelCase(str) {
        return str.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
    }
}

// Initialize Growth Engine
document.addEventListener('DOMContentLoaded', () => {
    window.growthEngine = new GrowthEngine();
});

// Global action handlers
function startActivationFlow() {
    window.growthEngine.trackEvent('activation_started');
    // Would open the activation flow
    alert('60-second quote flow would start here');
}
</script>