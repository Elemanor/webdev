<!-- Conversion Funnel Optimization - Marcus Chen Implementation -->
<section class="conversion-funnel-section py-5">
    <div class="container">
        <!-- Trust Building Layer -->
        <div class="trust-layer mb-5">
            <div class="row align-items-center">
                <div class="col-md-3 text-center mb-3 mb-md-0">
                    <div class="trust-metric">
                        <i class="fas fa-home fs-1 text-primary mb-2"></i>
                        <h3 class="h4 mb-0">50,847</h3>
                        <p class="text-muted mb-0">Homes Protected</p>
                    </div>
                </div>
                <div class="col-md-3 text-center mb-3 mb-md-0">
                    <div class="trust-metric">
                        <i class="fas fa-star fs-1 text-warning mb-2"></i>
                        <h3 class="h4 mb-0">4.9/5</h3>
                        <p class="text-muted mb-0">Average Rating</p>
                    </div>
                </div>
                <div class="col-md-3 text-center mb-3 mb-md-0">
                    <div class="trust-metric">
                        <i class="fas fa-clock fs-1 text-success mb-2"></i>
                        <h3 class="h4 mb-0">2 Hours</h3>
                        <p class="text-muted mb-0">Average Response</p>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="trust-metric">
                        <i class="fas fa-shield-alt fs-1 text-info mb-2"></i>
                        <h3 class="h4 mb-0">Lifetime</h3>
                        <p class="text-muted mb-0">Warranty</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Value Proposition Matrix -->
        <div class="value-matrix mb-5">
            <h2 class="text-center mb-4">Why 50,000+ Toronto Homeowners Choose Us</h2>
            <div class="comparison-table">
                <table class="table table-bordered">
                    <thead class="bg-primary text-white">
                        <tr>
                            <th>What You Get</th>
                            <th class="text-center">Dryspace</th>
                            <th class="text-center">Others</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Response Time</td>
                            <td class="text-center text-success">
                                <i class="fas fa-check-circle"></i> Under 2 Hours
                            </td>
                            <td class="text-center text-danger">
                                <i class="fas fa-times-circle"></i> 2-5 Days
                            </td>
                        </tr>
                        <tr>
                            <td>Warranty</td>
                            <td class="text-center text-success">
                                <i class="fas fa-check-circle"></i> Lifetime Transferable
                            </td>
                            <td class="text-center text-danger">
                                <i class="fas fa-times-circle"></i> 1-10 Years
                            </td>
                        </tr>
                        <tr>
                            <td>City Rebate Help</td>
                            <td class="text-center text-success">
                                <i class="fas fa-check-circle"></i> Full $3,400 Support
                            </td>
                            <td class="text-center text-danger">
                                <i class="fas fa-times-circle"></i> DIY Application
                            </td>
                        </tr>
                        <tr>
                            <td>Price Transparency</td>
                            <td class="text-center text-success">
                                <i class="fas fa-check-circle"></i> Instant Online Quote
                            </td>
                            <td class="text-center text-danger">
                                <i class="fas fa-times-circle"></i> Hidden Fees
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Conversion Path Optimizer -->
        <div class="conversion-paths">
            <h3 class="text-center mb-4">Choose Your Path to a Dry Basement</h3>
            <div class="row g-4">
                <!-- Path 1: Urgent -->
                <div class="col-md-4">
                    <div class="conversion-path urgent-path h-100">
                        <div class="path-header bg-danger text-white p-3">
                            <h4 class="h5 mb-0">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Emergency Service
                            </h4>
                        </div>
                        <div class="path-content p-4">
                            <p class="fw-bold">Water in your basement NOW?</p>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>24/7 emergency response</li>
                                <li><i class="fas fa-check text-success me-2"></i>On-site in under 2 hours</li>
                                <li><i class="fas fa-check text-success me-2"></i>Immediate water removal</li>
                            </ul>
                            <div class="path-cta">
                                <a href="tel:4375450067" class="btn btn-danger btn-lg w-100">
                                    <i class="fas fa-phone-alt me-2"></i>
                                    Call Emergency Line
                                </a>
                                <p class="text-center mt-2 mb-0">
                                    <small>Average response: 47 minutes</small>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Path 2: Planning -->
                <div class="col-md-4">
                    <div class="conversion-path planning-path h-100">
                        <div class="path-header bg-primary text-white p-3">
                            <h4 class="h5 mb-0">
                                <i class="fas fa-calculator me-2"></i>
                                Get Instant Quote
                            </h4>
                        </div>
                        <div class="path-content p-4">
                            <p class="fw-bold">Planning waterproofing?</p>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Accurate pricing in 60 seconds</li>
                                <li><i class="fas fa-check text-success me-2"></i>See all options & costs</li>
                                <li><i class="fas fa-check text-success me-2"></i>No salesperson required</li>
                            </ul>
                            <div class="path-cta">
                                <button class="btn btn-primary btn-lg w-100" 
                                        onclick="scrollToCalculator()">
                                    <i class="fas fa-calculator me-2"></i>
                                    Calculate My Cost
                                </button>
                                <p class="text-center mt-2 mb-0">
                                    <small>Used by 2,847 homeowners this month</small>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Path 3: Information -->
                <div class="col-md-4">
                    <div class="conversion-path info-path h-100">
                        <div class="path-header bg-success text-white p-3">
                            <h4 class="h5 mb-0">
                                <i class="fas fa-comments me-2"></i>
                                Talk to an Expert
                            </h4>
                        </div>
                        <div class="path-content p-4">
                            <p class="fw-bold">Have questions?</p>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Free consultation</li>
                                <li><i class="fas fa-check text-success me-2"></i>Honest recommendations</li>
                                <li><i class="fas fa-check text-success me-2"></i>No pressure, ever</li>
                            </ul>
                            <div class="path-cta">
                                <button class="btn btn-success btn-lg w-100"
                                        onclick="startChat()">
                                    <i class="fas fa-comments me-2"></i>
                                    Start Live Chat
                                </button>
                                <p class="text-center mt-2 mb-0">
                                    <small>Sarah is online now</small>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Objection Handlers -->
        <div class="objection-handling mt-5">
            <div class="row">
                <div class="col-md-6">
                    <div class="objection-card mb-4">
                        <h5>
                            <i class="fas fa-dollar-sign text-warning me-2"></i>
                            "It's too expensive"
                        </h5>
                        <div class="objection-response">
                            <p class="mb-2">We understand budget concerns. That's why we offer:</p>
                            <ul>
                                <li>$3,400 city rebate assistance</li>
                                <li>Financing from $89/month</li>
                                <li>Price match guarantee</li>
                                <li>Free second opinions</li>
                            </ul>
                            <button class="btn btn-sm btn-outline-primary" 
                                    onclick="showFinancingOptions()">
                                View Payment Options
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="objection-card mb-4">
                        <h5>
                            <i class="fas fa-clock text-info me-2"></i>
                            "I need to think about it"
                        </h5>
                        <div class="objection-response">
                            <p class="mb-2">Take your time! Meanwhile:</p>
                            <ul>
                                <li>Get our free planning guide</li>
                                <li>Lock in today's pricing for 30 days</li>
                                <li>Schedule a no-pressure consultation</li>
                                <li>See what neighbors paid</li>
                            </ul>
                            <button class="btn btn-sm btn-outline-info"
                                    onclick="downloadGuide()">
                                Get Free Guide
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Reversal -->
        <div class="risk-reversal text-center mt-5 p-4 bg-light rounded">
            <h3 class="mb-4">Our Iron-Clad Guarantees</h3>
            <div class="row">
                <div class="col-md-4">
                    <div class="guarantee-item">
                        <i class="fas fa-money-bill-wave fs-1 text-success mb-3"></i>
                        <h5>Money-Back Guarantee</h5>
                        <p>Not satisfied? Get 100% of your money back within 30 days</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="guarantee-item">
                        <i class="fas fa-trophy fs-1 text-warning mb-3"></i>
                        <h5>Lifetime Warranty</h5>
                        <p>Your basement stays dry forever, or we fix it free</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="guarantee-item">
                        <i class="fas fa-tags fs-1 text-primary mb-3"></i>
                        <h5>Price Match Plus</h5>
                        <p>Find a lower quote? We'll beat it by 10%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Conversion Optimization Scripts -->
<script>
// Funnel tracking
class ConversionFunnel {
    constructor() {
        this.steps = {
            'awareness': { name: 'Page View', completed: true },
            'interest': { name: 'Content Engagement', completed: false },
            'consideration': { name: 'Path Selection', completed: false },
            'intent': { name: 'CTA Click', completed: false },
            'evaluation': { name: 'Form/Call Start', completed: false },
            'purchase': { name: 'Conversion', completed: false }
        };
        
        this.trackFunnelProgress();
    }

    trackFunnelProgress() {
        // Track scroll depth for interest
        let maxScroll = 0;
        window.addEventListener('scroll', () => {
            const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
            if (scrollPercent > maxScroll) {
                maxScroll = scrollPercent;
                if (scrollPercent > 30 && !this.steps.interest.completed) {
                    this.completeStep('interest');
                }
            }
        });

        // Track path selection
        document.querySelectorAll('.conversion-path').forEach(path => {
            path.addEventListener('mouseenter', () => {
                if (!this.steps.consideration.completed) {
                    this.completeStep('consideration');
                }
            });
        });

        // Track CTA clicks
        document.querySelectorAll('.btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (!this.steps.intent.completed) {
                    this.completeStep('intent');
                }
            });
        });
    }

    completeStep(stepName) {
        this.steps[stepName].completed = true;
        
        // Track in analytics
        if (window.trackABGoal) {
            window.trackABGoal(`funnel_${stepName}`);
        }
        
        // Update visual funnel if exists
        this.updateFunnelVisualization();
        
        // Trigger next step optimization
        this.optimizeForNextStep(stepName);
    }

    optimizeForNextStep(completedStep) {
        const optimizations = {
            'interest': () => {
                // Show more compelling CTAs
                setTimeout(() => {
                    this.enhanceCTAs();
                }, 3000);
            },
            'consideration': () => {
                // Highlight best path
                this.highlightOptimalPath();
            },
            'intent': () => {
                // Show urgency or special offer
                this.showTimeSensitiveOffer();
            }
        };

        if (optimizations[completedStep]) {
            optimizations[completedStep]();
        }
    }

    enhanceCTAs() {
        document.querySelectorAll('.btn-primary').forEach(btn => {
            if (!btn.classList.contains('enhanced')) {
                btn.classList.add('enhanced', 'pulse-animation');
            }
        });
    }

    highlightOptimalPath() {
        // Determine optimal path based on user behavior
        const paths = document.querySelectorAll('.conversion-path');
        const optimalPath = paths[1]; // Default to quote path
        
        optimalPath.classList.add('recommended-path');
        optimalPath.querySelector('.path-header').insertAdjacentHTML('beforeend', 
            '<span class="badge bg-warning ms-2">Recommended</span>'
        );
    }

    showTimeSensitiveOffer() {
        if (sessionStorage.getItem('offerShown')) return;
        
        const offer = document.createElement('div');
        offer.className = 'time-sensitive-offer';
        offer.innerHTML = `
            <div class="alert alert-success alert-dismissible fade show position-fixed bottom-0 start-50 translate-middle-x mb-4" 
                 style="z-index: 1050; max-width: 500px;">
                <h5 class="alert-heading">
                    <i class="fas fa-gift me-2"></i>Limited Time: Save $500
                </h5>
                <p class="mb-2">Book your waterproofing assessment in the next 10 minutes and save $500!</p>
                <div class="d-flex gap-2">
                    <a href="tel:4375450067" class="btn btn-success">Claim Offer</a>
                    <button type="button" class="btn btn-outline-success" data-bs-dismiss="alert">Maybe Later</button>
                </div>
                <div class="offer-timer mt-2">
                    <small>Offer expires in: <span id="offer-countdown">10:00</span></small>
                </div>
            </div>
        `;
        
        document.body.appendChild(offer);
        sessionStorage.setItem('offerShown', 'true');
        
        // Start countdown
        this.startOfferCountdown();
    }

    startOfferCountdown() {
        let seconds = 600; // 10 minutes
        const countdown = document.getElementById('offer-countdown');
        
        const timer = setInterval(() => {
            seconds--;
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            countdown.textContent = `${minutes}:${secs.toString().padStart(2, '0')}`;
            
            if (seconds <= 0) {
                clearInterval(timer);
                document.querySelector('.time-sensitive-offer').remove();
            }
        }, 1000);
    }

    updateFunnelVisualization() {
        // Update any visual funnel representation
        console.log('Funnel progress:', this.steps);
    }
}

// Path-specific functions
function scrollToCalculator() {
    document.getElementById('waterproofing-calculator').scrollIntoView({ 
        behavior: 'smooth',
        block: 'start'
    });
    
    // Track goal
    if (window.trackABGoal) {
        window.trackABGoal('calculator_path_selected');
    }
}

function startChat() {
    // Implementation for chat
    if (window.trackABGoal) {
        window.trackABGoal('chat_path_selected');
    }
    
    // Show chat widget
    if (document.getElementById('chat-popup')) {
        document.getElementById('chat-popup').style.display = 'block';
    }
}

function showFinancingOptions() {
    // Show financing modal or section
    if (window.trackABGoal) {
        window.trackABGoal('financing_interest');
    }
}

function downloadGuide() {
    // Track and provide guide
    if (window.trackABGoal) {
        window.trackABGoal('guide_downloaded');
    }
    
    // Simulate download
    alert('Guide download would start here');
}

// Initialize funnel tracking
document.addEventListener('DOMContentLoaded', () => {
    new ConversionFunnel();
});
</script>

<style>
/* Conversion Funnel Styles */
.trust-metric {
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 10px;
    transition: transform 0.3s ease;
}

.trust-metric:hover {
    transform: translateY(-5px);
}

/* Comparison Table */
.comparison-table {
    overflow-x: auto;
}

.comparison-table .fa-check-circle {
    font-size: 1.25rem;
}

.comparison-table .fa-times-circle {
    font-size: 1.25rem;
}

/* Conversion Paths */
.conversion-path {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
    cursor: pointer;
}

.conversion-path:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.conversion-path.recommended-path {
    border-color: #ffc107;
    box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
}

.path-header {
    text-align: center;
}

.path-content {
    background: white;
}

/* Objection Cards */
.objection-card {
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 10px;
    border-left: 4px solid #0d6efd;
}

.objection-response {
    margin-top: 1rem;
    padding-left: 2rem;
}

/* Guarantees */
.guarantee-item {
    padding: 1.5rem;
}

/* Pulse Animation */
@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(13, 110, 253, 0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(13, 110, 253, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(13, 110, 253, 0);
    }
}

.pulse-animation {
    animation: pulse 2s infinite;
}

/* Mobile Optimization */
@media (max-width: 768px) {
    .conversion-path {
        margin-bottom: 1rem;
    }
    
    .trust-metric {
        margin-bottom: 1rem;
    }
    
    .comparison-table {
        font-size: 0.875rem;
    }
}
</style>